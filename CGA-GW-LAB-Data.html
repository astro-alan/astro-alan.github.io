<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gravitational Lab Temperature Monitoring System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light text-dark">
  <div class="container py-5">
    <h1 class="text-center">ANU Centre for Gravitational Astrophysics</h1>
    <h3 class="text-center mb-5">Gravitational Lab Temperature Monitoring System</h3>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">BOM Temperature (Mock Data for Canberra Airport)</h5>
        <canvas id="bomTempChart" height="100"></canvas>
        <p class="text-muted mt-2" id="updated-time">Last updated: 30 July 2025</p>

        <div class="mt-4">
          <strong>Statistics:</strong><br>
          Min: <span id="temp-min">–</span> °C<br>
          Max: <span id="temp-max">–</span> °C<br>
          Mean: <span id="temp-mean">–</span> °C
        </div>

        <button class="btn btn-outline-primary mt-3" onclick="exportCSV()">Export to CSV</button>
      </div>
    </div>
  </div>

  <script>
    // Mocked BOM data (from your example)
    const bomData = [
      { time: "20250730133000", air_temp: 8.2 },
      { time: "20250730130000", air_temp: 7.9 },
      { time: "20250730123000", air_temp: 8.4 },
      { time: "20250730120000", air_temp: 8.4 },
      { time: "20250730113000", air_temp: 8.6 }
    ];

    const timestamps = bomData.map(e => {
      return `${e.time.slice(0,4)}-${e.time.slice(4,6)}-${e.time.slice(6,8)} ${e.time.slice(8,10)}:${e.time.slice(10,12)}`;
    });

    const temps = bomData.map(e => e.air_temp);

    const stats = {
      min: Math.min(...temps).toFixed(1),
      max: Math.max(...temps).toFixed(1),
      mean: (temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(1)
    };

    document.getElementById("temp-min").textContent = stats.min;
    document.getElementById("temp-max").textContent = stats.max;
    document.getElementById("temp-mean").textContent = stats.mean;

    const ctx = document.getElementById('bomTempChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: timestamps,
        datasets: [{
          label: 'Air Temp (°C)',
          data: temps,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          fill: true,
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: { display: true, text: 'Time' },
            ticks: { maxRotation: 90, minRotation: 45 }
          },
          y: {
            title: { display: true, text: 'Temperature (°C)' }
          }
        }
      }
    });

    function exportCSV() {
      let csv = "Timestamp,Temperature (°C)\n";
      for (let i = 0; i < timestamps.length; i++) {
        csv += `${timestamps[i]},${temps[i]}\n`;
      }
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "canberra_temperature_mock.csv";
      link.click();
    }
  </script>
</body>
</html>
